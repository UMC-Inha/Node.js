외래키
![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/71d4eb56-3b0e-4631-8858-810998a71a15/image.png)

위의 상황에서 “알림테이블”이 “알림카테고리”라는 테이블을 참조할 때 

“알림카테고리” 테이블에서의 기본키(Primary key)를 “알림테이블”에서 “알림카테고리ID”라는 속성으로 사용하는 경우 이 때의 “알림카테고리ID”를 “알림테이블”의 외래키 라고 한다.

즉, 어느 하나의 테이블이 다른 테이블의 기본키를 속성으로 가질 때 해당 속성을 외래키라고 한다.

외래키는 두 테이블을 연관지을 때 사용되며 참조하는(referencing) 테이블의 외래키의 값은 참조되는(referenced) 테이블의 기본키로 값이 꼭 존재해야한다는 외래키 제약조건이 있다.

위 제약조건을 설정하는 SQL문법은 아래와 같다

```sql
FOREIGN KEY(alert_category_id) REFERENCES Alert_categories(id)
```

외래키가 기본키에 포함이 된다면 즉, 외래키를 데이터를 구분하는 식별자로 사용한다면 연관된 두 테이블의 관계를 식별자 관계라고하며 그렇지 않다면 비식별자 관계라고 한다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/b362810d-2f66-48e8-be06-2249fdc5f4a7/image.png)

다음과 같은 경우는 tags_books 테이블과 양 두 테이블간의 관계는 비식별자 관계라 할 수 있다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/8961b7be-17c0-47ab-a891-f182a48f6025/image.png)

하지만 이경우는 tags_books 테이블의 기본키로 description_id와 tag_id를 사용하기 때문에 식별자 관계가 된다.

대부분의 경우 외래키는 비식별 관계로 주로 활용한다. 하지만 다음과 같이 단순히 두 테이블을 다대다 관계로 매핑하기 위한 목적의 테이블은 각각의 테이블의 기본키를 가져와 해당 테이블의 기본키 그대로 활용하기도 한다.

만약 tags_books 테이블이 어떤 다른 중요 용도가 있다면 이때는 기본키 속성을 따로 만들어주고 해당 외래키를 비식별자로 사용하는 것이 바람직하다.


기본키
![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/770c7623-1ced-4b53-a908-44f7358d597f/image.png)

기본키는 위의 예에서 id 필드에 해당되며 보통 bigint의 타입으로 둔다.

기본키는 테이블에서 데이터를 유일하게 식별할 수 있는 식별자의 역할을 한다.

기본키는 데이터를 유일하게 식별하는 것이 목적이기에 절대 중복되어서는 안되며 NULL값도 허용하지 않는다.(기본키 제약조건)

기본키는 하나의 컬럼만 가지는 게 아닌 여러 컬럼으로 하나의 기본키로 설정할 수도 있다. 이러한 키를 복합키라고 한다.

```sql
PRIMARY KEY(id) #다음과 같이 설정을 해주거나

id bigint PRIMARY KEY # 이렇게 column을 정의하면서 기본키 속성을 부여할 수 있다
```

ER 다이어그램
ER(Entity-Relation) 다이어그램(diagram)이란?

Entity - Entity, Entity - Relation 간의 관계를 도식화 한것을 말하며

아래의 여러 테이블이 있는 그림을 ER 다이어그램이라고 한다

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/d0c8d9ad-bc99-48ba-96fd-1cb18401e2cd/image.png)

Entity

Entity(개체) - DB상에서 관리하고 싶은 사물

위 그림 상에서 Users, Books에 해당하는 테이블들을 Entity라고 한다

Entity는 Attribute(속성)를 가지며 테이블 상에서의 컬럼에 해당한다

Entity의 속성 중 유일하게 구분할 수 있는 속성을 기본키라고 한다

Relation

Relation(관계) - Entity-Entity 간의 관계를 의미

예를 들어, 도서 대여관련 DB에서 사용자는 책을 여러권 대여 할 수 있다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/38acafa5-5e2f-488a-8d83-f36a04fdeed3/image.png)

여기서 대여가 두 Entity간의 관계(Relation)를 말하며, Relation 역시 attribute를 가질 수 있으며 아래와 같이 테이블로 표현 할 수있다.

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/163f1fc0-97a7-45a0-adaf-7344254de051/image.png)

Relation은 관계의 종류에 따라(일대일 관계, 일대다 관계, 다대다 관계)

기본키를 관련 Entity로 부터의 외래키로 식별자 관계를 통해 형성하거나 아니면 위의 대여 테이블 처럼 id속성을 통해 기본키를 설정할 수 있다.


복합키
기본키를 결정 짓는 attribute가 두개이상인 기본키를 복합키라고 한다

주의할 점은 테이블 당 기본키가 여러개 있는 것이 아니라 기본키는 한개이어야 하며 기본키를 구성하는 컬럼의 수가 여러개일 수 있는 것이다. 이것을 복합키라고 한다.


연관관계
Entity간의 관계의 종류에는 카디널리티에 따라 총 3개의 종류가 존재한다.

1. 일대일 관계
    
    하나의 Entity set과 다른 하나의 Entity set 사이의 연관을 지을 때 
    
    하나의 Entity set에 있는 어떤 Entity가 다른 Entity set에 있는 어떤 Entity 하나와만 관계를 갖는 것을 의미한다
    
    예를 들어,
    
    학생마다 지도교수 1명씩 존재하며, 지도교수 또한 관리하는 학생이 1명만 존재하는 경우 이럴때 일대일 관계로 표현한다
    
    둘의 관계를 나타내는 테이블을 만든다면 해당 테이블의 기본키로는 두 테이블의 기본키중 아무거나 하나로 쓰면되지만
    
    이경우에는 관계를 나타내는 테이블을 따로 만들지 않고 하나의 테이블에 다른테이블의 기본키를 외래키로 갖는다.
    
    일대일 관계는 아래처럼 양쪽 테이블 모두 하나의 짝대기로 표시한다
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/0913595d-62d9-41f1-9d2a-0874761db46e/image.png)
    
2. 일대다 관계
    
    하나의 Entity set과 다른 하나의 Entity set 사이의 연관을 지을 때 
    
    하나의 Entity set에 있는 어떤 Entity가 다른 Entity set에 있는 여러 Entity와 관계를 맺는 것을 의미하고 반대입장에서는 하나의 관계만 맺어야 함을 의미하는 관계이다.
    
    예를 들어,
    
    우리 인하대학교 지도교수 시스템 처럼, 하나의 학생은 지도교수가 한분만 매칭이 되지만 교수님은 여러학생을 지도할 수 있는 이러한 경우를 일대다 관계로 표현한다.
    
    이러한 일대다 관계를 테이블로 만든다면 해당 테이블의 기본키는 양 쪽 모두의 기본키를 합쳐서 관계의 기본키로 사용할 수 있지만, “일”에 해당하는 Entity set에서의 기본키만으로 관계를 구분할 수 있기 때문에 보통은 “일”에 해당하는 기본키를 가져와 기본키로 사용한다.
    
    위 말을 예를 들어 포현하자면 
    
    교수와 학생의 일대다 관계를 지도라는 테이블을 이용해 만든다면 지도의 기본키는 학생의 기본키만으로 충분하다는 의미이다.
    
    일반적으로 일대다 관계를 따로 테이블을 만들어 관리하지 않고자 한다면 “다”에 해당하는 테이블에 외래키로 “일”의 기본키를 속성으로 둔다!
    
    일대다 관계는 아래처럼 “일”에 해당하는 테이블에는 하나의 짝대기로 “다”에 해당하는 테이블에는 삼지창모양의 짝대기로 표시한다.
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/fd8f12e3-d574-4597-8125-5b9bc5b14af2/image.png)
    
3. 다대다 관계
    
    하나의 Entity set과 다른 하나의 Entity set 사이의 연관을 지을 때 
    
    하나의 Entity set에 있는 어떤 Entity가 다른 Entity set에 있는 여러 Entity와 관계를 맺는 것을 의미하고 반대입장에서도 마찬가지로 여러 Entity와 관계를 맺을 수 있는 관계를 말한다.
    
    예를 들어,
    
    교수가 여러 학생들을 전담할 수 있고, 학생 또한 지도를 여러 교수님께 받을 수 있는 이러한 관계를 다대다 관계라고한다.
    
    이러한 다대다 관계를 테이블로 만든다면 해당 테이블의 기본키는 양 쪽 Entity set에서의 기본키를 모두 합쳐서 관계의 기본키로 만들어야 한다.
    
    이를 예로 들어 설명하면 학생과 교수의 다대다 관계를 지도라는 테이블을 통해 표현한다고 하면 지도 테이블의 기본키는 학생의 기본키 + 교수의 기본키로 이루어진 복합키의 형태로 기본키를 구성해야한다.
    
    그래야 지도관계를 구분 할 수 있다.
    
    그리고 다대다 관계는 일대일 관계나 일대다 관계처럼 테이블로 표현하지 않고는 구현이 불가 하며 이를 테이블로 표현 할 때는 양쪽의 Entity set에 해당하는 테이블과 관계에 해당하는 테이블이 일대다 관계로 표현한다
    
    즉, 교수와 지도 테이블간의 관계를 일대다, 학생과 지도 테이블간의 관계를 일대다   일대다 관계 두개로 설계해야 한다.
    
    아래는 “책 설명”과 “해시태그”의 다대다 관계를 설계한 모습이다
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/54ce7765-25c5-48b0-96e3-9f2692d13111/image.png)
    

식별/비식별 관계로 구분도 가능하다

식별자 관계

하나의 기본키가 다른 하나의 기본키에 포함이 되는 경우를 말한다

비식별자 관계

하나의 기본키가 다른 하나의 기본키 구성에 포함 되지 않는 경우를 말한다.


정규화
데이터 베이스상에서 데이터의 일관성을 유지하고, 중복을 최소화 하며, 데이터의 유연성을 최소화 하기위해 데이터를 나누어 관리하기 위한 것이다.

예를 들어, 학생이라는 하나의 테이블에 학과에 대한 정보, 동아리에 대한 정보 등 많은 정보들이 들어 있다고 가정해보자.

이 때 수많은 같은 학과 학생들은 테이블상에 학과에 대한 정보들이 모두 중복해서 들어가게된다. 이렇게 관리하면 불필요하게 많은정보들이 중복으로 저장되게 되고 공간의 낭비가 심화된다. 학생들이 많을 수록 중복 데이터는 더더욱 많아지고 쓸데 없이 공간만 더 소비하게 될 것이다.

이 때 정규화라는 방식을 사용하면 중복되는 학과에 대한 테이블을 따로 만들고 학생 테이블에서는 학과에 대한 정보를 담는 컬럼을 없애고 대신 이 두 테이블을 관계로 매핑하게 된다.

이렇게 함으로써 어떤 데이터가 어떤테이블에 있는지 알아보기도 쉽고 데이터가 중복으로 저장되는 것도 막을 수 있다!!

정규화는 다음의 절차의 정규화가 존재한다

![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/2936ee9c-cc42-4db1-8f20-2df85643d474/image.png)

1. 제1정규화
    
    제1정규화에서 속성의 원자성 확보는 다음을 의미한다.
    
    예를 들어, 학생이라는 테이블에 속성으로 전화번호가 있다고 하자
    
    전화번호에는 집전화번호와 휴대전화번호가 있으니까 하나의 행에는 집전화번호를 넣고 또 다른 행에는 휴대전화번호를 넣게되면, 테이블에 같은 학생이 두번 들어가게 된 것이다.
    
    이렇게되면 학생을 유일하게 식별이 불가하기 때문에 이러한 속성을 갖는 부분을 분리 시키는 것이 제1정규화이다.
    
    즉, 제1정규화의 목적은 테이블에서 데이터를 유일하게 식별가능하도록 하는 것이다!
    
2. 제2정규화
    
    부분함수 종속성 제거를 목적으로 한다.
    
    기본키가 복합키로 구성이 되어있을 때 이 복합키가 아닌 컬럼들은 모두 키에 종속해야 함을 의미한다.
    
    예를 들어, 아래의 테이블이 존재한다고 가정해보자
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/8f20c36f-3a52-42d7-ae65-aa5c5b860799/image.png)
    
    위 테이블에서 기본키는 학번 + 수강학기 + 과목명 으로 이루어진 복합키 이다.
    
    여기서 성적이라는 속성은 학번 +  수강학기 + 과목명을 모두 알아야 조회를 할 수 있는 종속된 속성이다.
    
    하지만 제한인원이라는 속성은 학번과 전혀 무관하다
    
    이러한 무관함을 해결하기위해 테이블을 둘로 나누는 것을 제2정규화라고 한다.
    
3. 제3정규화
    
    이행적 함수 종속성 제거를 목적으로 한다.
    
    제 2정규형을 만족하고, 테이블 내의 모든 속성이 키에만 의존하며 다른 후보키에 의존하지 않는다.
    
    즉 모든 키가 아닌 컬럼은 키에 종속해야 하며
    
    뿐만 아니라 다른 컬럼에 종속되지 않고 오직 키에만 종속되어야 함을 말한다
    
    ![image.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/f1912130-0409-4e90-a90f-6091ae253e73/769cc22d-8b49-4ba1-8e25-a7d07b838bde/image.png)
    
    위 테이블을 예로 들면 제 2정규형을 만족하지만 대학, 전공 컬럼을 보면 전공이라는 컬럼이 대학에 종속됨을 확인 할 수 있기에 위 형태는 제3정규형을 만족하지 않음을 볼 수 있다.
    
    따라서 제3정규형의 만족을 위해 대학, 전공을 부분이랑 분리해서 새로운 테이블 두개로 쪼개야 할 것이다.
  

반 정규화
테이블을 많이 쪼개다보면 데이터의 중복은 피할 수 있지만 JOIN 연산을 통해 데이터를 하나로 합쳐 표현해야 하는데 JOIN연산이  성능적인 면에서는 두개의 테이블을 조회하기 때문에 좋지 않다.

만약 어떤 두개의 데이터를 각각 따로 필요한 경우가 없이 항상 같이 보여줘야 한다면 굳이 테이블을 쪼개고 JOIN연산을 할 이유가 없을 것이다.

이럴 때 성능적인 향상을 위해 두 테이블로 쪼개지 않고 하나의 테이블로 합쳐서 데이터 조회시 하나의 테이블에만 접근 할 수 있게 하는 것을 반 정규화 라고한다

즉, 반 정규화는 성능 향상을 위해 속성을 여러 테이블로 관리하지않고 하나의 테이블로 모으는 방식을 말한다